<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zand Cafe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #0052D4;
            --secondary-blue: #65C7F7;
            --accent-green: #2a9d8f;
            --accent-red: #e76f51;
            --text-dark: #023047;
            --text-light: #ffffff;
            --container-bg: rgba(255, 255, 255, 0.55);
            --border-color: rgba(255, 255, 255, 0.4);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(70deg, var(--primary-blue) 0%, #4364F7 50%, var(--secondary-blue) 100%);
            background-attachment: fixed;
            padding: 20px;
            color: var(--text-dark);
        }
        .container {
            max-width: 1300px;
            margin: auto;
            background: var(--container-bg);
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--container-bg);
            margin: 10% auto; padding: 25px; border-radius: 15px;
            max-width: 600px; box-shadow: var(--shadow); border: 1px solid var(--border-color);
        }
        .hidden { display: none; }
        h2 { text-align: center; display: flex; align-items: center; justify-content: center; gap: 15px; color: var(--primary-blue); font-weight: 700;}
        h3, h4 { font-weight: 600; margin-top: 15px; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; gap: 10px; }
        label { font-weight: 600; margin-top: 15px; display: block; margin-bottom: 5px; }
        input, select {
            padding: 12px; width: 100%; margin-top: 5px; border-radius: 10px; 
            border: 1px solid transparent; background: rgba(255,255,255,0.5);
            font-size: 16px; font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }
        input:focus, select:focus { background: #fff; box-shadow: 0 0 0 3px var(--secondary-blue); outline: none; }
        input[type="color"] { padding: 2px; width: 45px; height: 40px; }
        .buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; margin-top: 8px; }
        button { 
            padding: 12px; border: none; border-radius: 10px; cursor: pointer;
            transition: all .2s; font-weight: 600; font-size: 15px;
        }
        button:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .manage-btn { font-size: 24px; background: none; box-shadow: none; padding: 5px; color: var(--primary-blue); }
        .type-btn { color: var(--text-light); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .pay-btn { background: #e9ecef; }
        .pay-btn.active.cash { background: var(--accent-green); color: var(--text-light); }
        .pay-btn.active.debt { background: var(--accent-red); color: var(--text-light); }
        .add-btn { background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue)); color: var(--text-light); width: 100%; margin-top: 20px; font-size: 16px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; border-radius: 12px; overflow: hidden; background: #fff; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: var(--primary-blue); color: var(--text-light); font-weight: 600; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .total, .report, .debt-box { margin-top: 20px; padding: 15px; border-radius: 12px; background: var(--container-bg); border: 1px solid var(--border-color); }
        .debt-card { margin: 8px 0; padding: 12px; border-radius: 8px; background: #fff; border-right: 4px solid var(--accent-red); }
        .menu-item-manage { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.7); padding: 10px; border-radius: 8px; margin-bottom: 8px; }
        .price-input-in-cart { width: 80px; text-align: center; }
        .price-controls { display: flex; align-items: center; gap: 8px; }
        .adjust-btn { padding: 5px; font-size: 18px; background-color: #e9ecef; width: 35px; height: 35px; border-radius: 50%; line-height: 1; box-shadow: none; }
        #main-menu-container { display: flex; flex-direction: column; gap: 15px; }
        .debt-row { background-color: #ffdddd !important; }
        .cash-row { background-color: #ddffdd !important; }
    </style>
</head>
<body>

<div id="loginBox" class="container" style="max-width: 450px; margin-top: 100px;">
    <h2>ğŸ” Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±</h2>
    <label for="password">Ù¾Ø§Ø³Û†Ø±Ø¯</label>
    <input type="password" id="password" placeholder="Ù¾Ø§Ø³Û†Ø±Ø¯Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•">
    <button class="add-btn" onclick="login()">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±</button>
</div>

<div id="app" class="container hidden">
    <h2>â˜• Zand Cafe <button class="manage-btn" onclick="toggleModal('menuManagement')">âš™ï¸</button><button class="manage-btn" onclick="toggleModal('customerManagement')">ğŸ‘¥</button></h2>
    
    <div id="menuManagement" class="modal"><div class="modal-content"><h2>Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù„ÛŒØ³Øª</h2><div class="report"><h4>â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø´ÛŒ Ù†ÙˆÛ</h4><div class="manage-inputs"><input type="text" id="newCategoryName" placeholder="Ù†Ø§ÙˆÛŒ Ø¨Û•Ø´"><input type="color" id="newCategoryColor" value="#0077b6"><button onclick="addCategory()">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button></div></div><div id="category-management-container"></div><button class="del-btn" style="width:100%; margin-top: 15px;" onclick="toggleModal('menuManagement')">Ø¯Ø§Ø®Ø³ØªÙ†</button></div></div>
    <div id="customerManagement" class="modal"><div class="modal-content"><h2>ğŸ‘¥ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ú©Ú•ÛŒØ§Ø±Û•Ú©Ø§Ù†</h2><div class="report"><h4>â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú©Ú•ÛŒØ§Ø±</h4><div class="manage-inputs"><input type="text" id="newCustomerName" placeholder="Ù†Ø§ÙˆÛŒ Ú©Ú•ÛŒØ§Ø±"><button onclick="addCreditCustomer()">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†</button></div></div><div id="credit-customer-list"></div><button class="del-btn" style="width:100%; margin-top: 15px;" onclick="toggleModal('customerManagement')">Ø¯Ø§Ø®Ø³ØªÙ†</button></div></div>

    <label>Ù†Ø§ÙˆÛŒ Ú©Ú•ÛŒØ§Ø±</label>
    <input id="customer" list="customer-suggestions">
    <datalist id="customer-suggestions"></datalist>
    
    <label>Ø¬Û†Ø±ÛŒ Ø´Øª</label>
    <div id="main-menu-container"></div>
        
    <label>Ù¾Ø§Ø±Û•Ø¯Ø§Ù†</label>
    <div class="buttons">
        <button class="pay-btn active cash" onclick="setPayment('Ù†Û•Ù‚Ø¯',this)">Ù†Û•Ù‚Ø¯</button>
        <button class="pay-btn" onclick="setPayment('Ù‚Û•Ø±Ø²',this)">Ù‚Û•Ø±Ø²</button>
    </div>
    
    <div id="currentOrderBox" class="report">
        <h4>ğŸ›’ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†ÛŒ Ø¦ÛØ³ØªØ§</h4>
        <div id="currentOrderList"></div>
        <div style="font-weight:bold; margin-top:10px; text-align: left;">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒ: <span id="currentOrderTotal">0</span></div>
    </div>
    <button class="add-btn" onclick="addItem()">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•Ú©Ø§Ù†</button>
    
    <hr style="margin: 25px 0; border: none; border-top: 1px solid rgba(0,0,0,0.1);">
    <label>Ø¨ÛŒÙ†ÛŒÙ†ÛŒ Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ú•Û†Ú˜</label>
    <select id="daySelect" onchange="render()"></select>
    
    <table><thead><tr><th>Ú•Û†Ú˜</th><th>Ú©Ø§Øª</th><th>Ú©Ú•ÛŒØ§Ø±</th><th>Ø¬Û†Ø±</th><th>Ù†Ø±Ø®</th><th>Ù¾Ø§Ø±Û•Ø¯Ø§Ù†</th><th>Ú¯Û†Ú•ÛŒÙ†</th><th>Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</th></tr></thead><tbody id="list"></tbody></table>
    
    <div class="total" style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap;">
        <span>Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ú•Û†Ú˜: <span id="total">0</span></span>
        <span>ğŸŸ¢ Ù†Û•Ù‚Ø¯: <span id="cash">0</span></span>
        <span>ğŸ”´ Ù‚Û•Ø±Ø²: <span id="debt">0</span></span>
    </div>
    
    <div class="debt-box">
        <h4>ğŸ“Œ Ù„ÛŒØ³ØªÛŒ Ù‚Û•Ø±Ø²</h4>
        <div id="debtList"></div>
        <div id="debtDetail" class="hidden" style="margin-top:10px;"></div>
        <div style="font-weight:bold; margin:10px 0;">Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ Ù‚Û•Ø±Ø²: <span id="totalDebt">0</span></div>
        <div class="buttons" style="grid-template-columns: repeat(3, 1fr);"><button onclick="showDebt('day')">Ù‚Û•Ø±Ø²ÛŒ Ø¦Û•Ù…Ú•Û†</button><button onclick="showDebt('month')">Ù‚Û•Ø±Ø²ÛŒ Ø¦Û•Ù… Ù…Ø§Ù†Ú¯Û•</button><button onclick="showDebt('all')">Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†</button></div>
    </div>
    
    <div class="report">
        <h4>ğŸ“Š Ú•Ø§Ù¾Û†Ø±ØªÛŒ Ù…Ø§Ù†Ú¯Ø§Ù†Û•</h4>
        <select id="monthSelect" onchange="monthlyReport()"></select>
        <div id="monthResult" style="margin-top: 10px;"></div>
    </div>
</div>
<script>
    const PASSWORD = "1234";
    let data = JSON.parse(localStorage.getItem("qawaData")) || [];
    let menuData;
    let creditCustomers = JSON.parse(localStorage.getItem("zandCreditCustomers")) || [];
    let currentOrder = [];
    let debtFilter = 'day';
    
    function migrateOldData() {
        let oldMenuData = JSON.parse(localStorage.getItem("zandMenu"));
        if (oldMenuData && !Array.isArray(oldMenuData)) {
            let newStructure = [
                { name: "â˜• Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú¯Û•Ø±Ù…", color: "#0077b6", items: oldMenuData.coffee || []},
                { name: "ğŸ• Ø®ÙˆØ§Ø±Ø¯Ù†", color: "#f77f00", items: oldMenuData.food || []},
                { name: "ğŸ° Ø´ÛŒØ±ÛŒÙ†ÛŒ", color: "#d62828", items: oldMenuData.sweet || []},
                { name: "ğŸ¥¤ Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•", color: "#02c39a", items: oldMenuData.drink || []}
            ];
            menuData = newStructure;
            saveMenuData();
        } else if (oldMenuData) {
            menuData = oldMenuData;
        } else {
            menuData = [
                { name: "â˜• Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ú¯Û•Ø±Ù…", color: "#0077b6", items: [{name: "Ù‚Ø§ÙˆÛ•", price: 1000}, {name: "Ú†Ø§", price: 500}]},
                { name: "ğŸ• Ø®ÙˆØ§Ø±Ø¯Ù†", color: "#f77f00", items: [{name: "Ù¾ÛŒØªØ²Ø§", price: 4000}]},
                { name: "ğŸ° Ø´ÛŒØ±ÛŒÙ†ÛŒ", color: "#d62828", items: [{name: "Ú©ÛÚ©", price: 1500}]},
                { name: "ğŸ¥¤ Ø®ÙˆØ§Ø±Ø¯Ù†Û•ÙˆÛ•", color: "#02c39a", items: [{name: "Ø¦Ø§Ùˆ", price: 250}]}
            ];
        }
    }
    migrateOldData();
    function login() {
        if (password.value === PASSWORD) {
            loginBox.classList.add("hidden");
            app.classList.remove("hidden");
            initApp();
        } else alert("Ù¾Ø§Ø³Û†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•");
    }
    function initApp(){
        renderMainMenu();
        renderManagementList();
        renderCustomerManagementList();
        renderCustomerSuggestions();
        initMonths(); 
        initDays(); 
        render(); 
        monthlyReport();
        renderCurrentOrder();
    }
    
    function saveMenuData() { localStorage.setItem("zandMenu", JSON.stringify(menuData)); }
    function saveCreditCustomers() { localStorage.setItem("zandCreditCustomers", JSON.stringify(creditCustomers)); }
    
    function toggleModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            const isHidden = modal.style.display === 'none' || modal.style.display === '';
            modal.style.display = isHidden ? 'block' : 'none';
        }
    }
    function renderMainMenu() {
        const container = document.getElementById('main-menu-container');
        container.innerHTML = "";
        menuData.forEach(category => {
            let categoryHtml = `<b>${category.name}</b>`;
            let buttonsHtml = category.items.map(item => 
                `<button class="type-btn" style="background-color:${category.color}" onclick="selectMenuItem('${item.name}', ${item.price}, this)">${item.name} (${item.price})</button>`
            ).join('');
            
            container.innerHTML += `<div class="report" style="padding:15px">${categoryHtml}<div class="buttons">${buttonsHtml}</div></div>`;
        });
    }
    function renderManagementList() {
        const container = document.getElementById('category-management-container');
        container.innerHTML = "";
        menuData.forEach((category, catIndex) => {
            const itemsHtml = category.items.map((item, itemIndex) => 
                `<div class="menu-item-manage"><span>${item.name} - ${item.price}</span><button class="del-btn" onclick="deleteMenuItem(${catIndex}, ${itemIndex})">âŒ</button></div>`
            ).join('');
            container.innerHTML += `
                <div class="report">
                    <h3>${category.name}<input type="color" value="${category.color}" onchange="updateCategoryColor(${catIndex}, this.value)"><button class="del-btn" onclick="deleteCategory(${catIndex})">ğŸ—‘ï¸</button></h3>
                    <div class="manage-inputs"><input type="text" id="newName-${catIndex}" placeholder="Ù†Ø§ÙˆÛŒ Ø´Øª"><input type="number" id="newPrice-${catIndex}" placeholder="Ù†Ø±Ø®"><button class="add-btn" style="margin:0; padding:12px;" onclick="addMenuItem(${catIndex})">â•</button></div>
                    <div>${itemsHtml}</div>
                </div>`;
        });
    }
    function addCategory() {
        const nameInput = document.getElementById('newCategoryName');
        if (!nameInput.value) return alert("ØªÚ©Ø§ÛŒÛ• Ù†Ø§ÙˆÛŒ Ø¨Û•Ø´Û•Ú©Û• Ø¨Ù†ÙˆÙˆØ³Û•");
        menuData.push({ name: nameInput.value, color: document.getElementById('newCategoryColor').value, items: [] });
        saveMenuData();
        nameInput.value = "";
        initApp();
    }
    function deleteCategory(catIndex) {
        if (!confirm(`Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¨Û•Ø´ÛŒ "${menuData[catIndex].name}"ØŸ`)) return;
        menuData.splice(catIndex, 1);
        saveMenuData();
        initApp();
    }
    function updateCategoryColor(catIndex, newColor) {
        menuData[catIndex].color = newColor;
        saveMenuData();
        initApp();
    }
    function addMenuItem(catIndex) {
        const nameInput = document.getElementById(`newName-${catIndex}`);
        const priceInput = document.getElementById(`newPrice-${catIndex}`);
        if (!nameInput.value || !priceInput.value) return alert("Ù†Ø§Ùˆ Ùˆ Ù†Ø±Ø® Ø¨Ù†ÙˆÙˆØ³Û•");
        menuData[catIndex].items.push({ name: nameInput.value, price: +priceInput.value });
        saveMenuData();
        nameInput.value = ""; priceInput.value = "";
        initApp();
    }
    function deleteMenuItem(catIndex, itemIndex) {
        if(!confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ")) return;
        menuData[catIndex].items.splice(itemIndex, 1);
        saveMenuData();
        initApp();
    }
    
    function renderCustomerManagementList() {
        const list = document.getElementById('credit-customer-list');
        list.innerHTML = "";
        creditCustomers.forEach((name, index) => {
            list.innerHTML += `<div class="menu-item-manage"><span>${name}</span><button class="del-btn" onclick="deleteCreditCustomer(${index})">âŒ</button></div>`;
        });
    }
    function renderCustomerSuggestions() {
        const datalist = document.getElementById('customer-suggestions');
        datalist.innerHTML = "";
        creditCustomers.forEach(name => {
            datalist.innerHTML += `<option value="${name}">`;
        });
    }
    function addCreditCustomer() {
        const nameInput = document.getElementById('newCustomerName');
        if (!nameInput.value || creditCustomers.includes(nameInput.value)) {
            alert("Ù†Ø§Ùˆ Ø¨Û•ØªØ§ÚµÛ• ÛŒØ§Ù† Ù¾ÛØ´ØªØ± Ø²ÛŒØ§Ø¯Ú©Ø±Ø§ÙˆÛ•!");
            return;
        }
        creditCustomers.push(nameInput.value);
        saveCreditCustomers();
        nameInput.value = "";
        renderCustomerManagementList();
        renderCustomerSuggestions();
    }
    function deleteCreditCustomer(index) {
        if (!confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ú©Ú•ÛŒØ§Ø±Û•ØŸ")) return;
        creditCustomers.splice(index, 1);
        saveCreditCustomers();
        renderCustomerManagementList();
        renderCustomerSuggestions();
    }
    function selectMenuItem(name, itemPrice, btn) {
        currentOrder.push({ name: name, price: itemPrice });
        renderCurrentOrder();
    }
    
    function renderCurrentOrder() {
        const list = document.getElementById('currentOrderList');
        const totalSpan = document.getElementById('currentOrderTotal');
        let currentTotal = 0;
        list.innerHTML = "";
        currentOrder.forEach((item, index) => {
            list.innerHTML += `<div class="menu-item-manage"><span>${item.name}</span><div class="price-controls"><button class="adjust-btn" onclick="adjustOrderItemPrice(${index}, -250)">-</button><input type="number" class="price-input-in-cart" value="${item.price}" oninput="updateOrderItemPrice(${index}, this.value)"><button class="adjust-btn" onclick="adjustOrderItemPrice(${index}, 250)">+</button><button class="del-btn" style="margin-left: 5px;" onclick="removeFromOrder(${index})">âŒ</button></div></div>`;
            currentTotal += item.price;
        });
        totalSpan.innerText = currentTotal;
    }
    
    function adjustOrderItemPrice(index, amount) {
        let newPrice = currentOrder[index].price + amount;
        currentOrder[index].price = (newPrice < 0) ? 0 : newPrice;
        renderCurrentOrder();
    }
    function updateOrderItemPrice(index, newPrice) {
        currentOrder[index].price = (+newPrice >= 0) ? +newPrice : 0;
        renderCurrentOrder();
    }
    function removeFromOrder(index) {
        currentOrder.splice(index, 1);
        renderCurrentOrder();
    }
    function setPayment(v, btn) {
        document.querySelector("#app").dataset.payment = v;
        document.querySelectorAll(".pay-btn").forEach(b => b.classList.remove("active", "cash", "debt"));
        btn.classList.add("active", v === "Ù†Û•Ù‚Ø¯" ? "cash" : "debt");
    }

    // === FEARNKSNAYA GORAWS ===
    function addItem() {
        if (currentOrder.length === 0) return alert("Ù‡ÛŒÚ† Ø´ØªÛÚ© Ø¨Û† Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† Ù‡Û•ÚµÙ†Û•Ø¨Ú˜ÛØ±Ø¯Ø±Ø§ÙˆÛ•!");

        const d = new Date();
        const customerName = document.getElementById('customer').value || "â€”";
        const paymentMethod = document.querySelector("#app").dataset.payment || 'Ù†Û•Ù‚Ø¯';
        const date = d.toLocaleDateString();
        const month = `${d.getFullYear()}-${d.getMonth() + 1}`;
        const time = d.toLocaleTimeString();

        // 1. Krdnawy shtakan ba group lagal currentOrder
        const groupedOrder = {};
        currentOrder.forEach(item => {
            // Drwstkrdny key bo shtakan
            const key = `${item.name}|${item.price}`; 
            if (!groupedOrder[key]) {
                groupedOrder[key] = {
                    name: item.name,
                    price: +item.price,
                    quantity: 0
                };
            }
            groupedOrder[key].quantity++;
        });

        // 2. Zyadkrdny shtakany group bo naw data array
        for (const key in groupedOrder) {
            const item = groupedOrder[key];
            const finalPrice = item.price * item.quantity;
            const finalType = item.quantity > 1 ? `${item.quantity} x ${item.name}` : item.name;

            data.unshift({ 
                date: date, 
                month: month, 
                time: time, 
                customer: customerName, 
                type: finalType, 
                price: finalPrice, 
                payment: paymentMethod 
            });
        }
        
        // 3. Reset krdnaway UI
        localStorage.setItem("qawaData", JSON.stringify(data));
        document.getElementById('customer').value = "";
        currentOrder = [];
        initApp();
    }
    
    function togglePayment(i) {
        data[i].payment = data[i].payment === "Ù‚Û•Ø±Ø²" ? "Ù†Û•Ù‚Ø¯" : "Ù‚Û•Ø±Ø²";
        localStorage.setItem("qawaData", JSON.stringify(data)); render(); monthlyReport();
    }
    function deleteItem(i) {
        if (!confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ø¯Ø§ÙˆØ§Ú©Ø§Ø±ÛŒÛŒÛ•ØŸ")) return;
        data.splice(i, 1);
        localStorage.setItem("qawaData", JSON.stringify(data)); render(); monthlyReport();
    }
    function showDebt(filter) { debtFilter = filter; render(); }
    function render() {
        if (!document.getElementById('daySelect').value && data.length > 0) initDays();
        let selectedDay = document.getElementById('daySelect').value;
        const list = document.getElementById('list'), debtList = document.getElementById('debtList'), debtDetail = document.getElementById('debtDetail');
        list.innerHTML = ""; debtList.innerHTML = ""; debtDetail.classList.add('hidden');
        let total = 0, cash = 0, debt = 0;
        let dayData = data.filter(x => x.date === selectedDay);
        dayData.forEach(x => {
            let realIndex = data.indexOf(x);
            total += x.price; if (x.payment === "Ù‚Û•Ø±Ø²") debt += x.price; else cash += x.price;
            list.innerHTML += `<tr class="${x.payment === "Ù‚Û•Ø±Ø²" ? "debt-row" : "cash-row"}"><td>${x.date}</td><td>${x.time}</td><td>${x.customer}</td><td>${x.type}</td><td>${x.price}</td><td>${x.payment}</td><td><button class="toggle-btn" onclick="togglePayment(${realIndex})">ğŸ”</button></td><td><button class="del-btn" onclick="deleteItem(${realIndex})">âŒ</button></td></tr>`;
        });
        const monthSelect = document.getElementById('monthSelect');
        let debtData = debtFilter === 'day' ? data.filter(x=>x.payment==="Ù‚Û•Ø±Ø²" && x.date===selectedDay) : debtFilter === 'month' ? data.filter(x => x.payment === "Ù‚Û•Ø±Ø²" && x.month === monthSelect.value) : data.filter(x => x.payment === "Ù‚Û•Ø±Ø²");
        let totalDebtAmount = debtData.reduce((sum, x) => sum + x.price, 0);
        document.getElementById('totalDebt').innerText = totalDebtAmount;
        let grouped = {}; debtData.forEach(x => { if (!grouped[x.customer]) grouped[x.customer] = 0; grouped[x.customer] += x.price; });
        for (let name in grouped) debtList.innerHTML += `<div class="debt-card" onclick="showDetail('${name}')"><div>${name} : ${grouped[name]}</div><div>â¡ï¸</div></div>`;
        document.getElementById('total').innerText = total; document.getElementById('cash').innerText = cash; document.getElementById('debt').innerText = debt;
        monthlyReport();
    }
    function showDetail(name) {
        const debtDetail = document.getElementById('debtDetail');
        let items = data.filter(x => x.customer === name && x.payment === "Ù‚Û•Ø±Ø²");
        let html = `<h4>Ù„ÛŒØ³ØªÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†ÛŒ ${name}:</h4>`;
        items.forEach(x => {
            let realIndex = data.indexOf(x);
            html += `<div class="menu-item-manage"><div><b>${x.type}</b> - ${x.price} (<i>${x.date}</i>)</div><div><button style="background:var(--accent-green);color:#fff;padding: 8px" onclick="payOne(${realIndex})">Ø¯Ø§Ù†Û•ÙˆÛ•</button><button class="del-btn" style="padding: 8px; margin-right: 5px;" onclick="deleteOne(${realIndex})">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button></div></div>`;
        });
        html += `<div class="buttons" style="margin-top:15px;"><button class="add-btn" style="background:var(--accent-green);" onclick="payAll('${name}')">Ø¯Ø§Ù†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†</button><button class="del-btn" onclick="deleteAll('${name}')">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù‡Û•Ù…ÙˆÙˆ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†</button></div>`;
        debtDetail.innerHTML = html; debtDetail.classList.remove('hidden');
    }
    function payOne(index) { data[index].payment = "Ù†Û•Ù‚Ø¯"; localStorage.setItem("qawaData", JSON.stringify(data)); initApp(); }
    function deleteOne(index) { data.splice(index, 1); localStorage.setItem("qawaData", JSON.stringify(data)); initApp(); }
    function payAll(name) { data.forEach(x => { if (x.customer === name && x.payment === "Ù‚Û•Ø±Ø²") x.payment = "Ù†Û•Ù‚Ø¯"; }); localStorage.setItem("qawaData", JSON.stringify(data)); initApp(); }
    function deleteAll(name) { data = data.filter(x => !(x.customer === name && x.payment === "Ù‚Û•Ø±Ø²")); localStorage.setItem("qawaData", JSON.stringify(data)); initApp(); }
    function initMonths() { 
        const monthSelect = document.getElementById('monthSelect');
        let m = [...new Set(data.map(x => x.month))];
        monthSelect.innerHTML = m.map(x => `<option value="${x}">${x}</option>`).join("");
    }
    function initDays() {
        const daySelect = document.getElementById('daySelect');
        let days = [...new Set(data.map(x => x.date))].sort((a, b) => new Date(b.split('/').reverse().join('-')) - new Date(a.split('/').reverse().join('-')));
        daySelect.innerHTML = days.map(d => `<option value="${d}">${d}</option>`).join("");
    }
    
    function monthlyReport() {
        const monthSelect = document.getElementById('monthSelect');
        const monthResult = document.getElementById('monthResult');
        if (!monthSelect.value) {
            monthResult.innerHTML = "";
            return;
        }
        let t = 0, c = 0, d = 0;
        data.filter(x => x.month === monthSelect.value).forEach(x => { t += x.price; x.payment === "Ù‚Û•Ø±Ø²" ? d += x.price : c += x.price; });
        monthResult.innerHTML = `<span>Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ: ${t}</span> | <span>Ù†Û•Ù‚Ø¯: ${c}</span> | <span>Ù‚Û•Ø±Ø²: ${d}</span>`;
    }
</script>

</body>
</html>
